const transformInsert = require( './insert.js' );
const transformFindAndModify = require( './findAndModify.js' );
const Log = require( '../../methods/log' );

module.exports = function transformSave( args ) {

    // if no _id, format as an insert
    if ( args[ 0 ] && !args[ 0 ]._id )
        return transformInsert( args );

    // if _id, format as findAndModify
    if ( args[ 0 ]._id ) {
        let _id = args[ 0 ]._id
        //delete args[0]._id      
        if ( !args[ 0 ].updatedAt )
            args[ 0 ].updatedAt = new Date();
        let qValue = transformFindAndModify([
            {
                query: {
                    _id: _id
                },
                update: {
                    $set: args[0]
                },
                new: true,
                upsert: true
            }
        ]);

        return qValue;
    }

    return args;

};
