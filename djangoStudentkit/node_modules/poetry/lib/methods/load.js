const Fs = require( 'fs' );
const Log = require( './log.js' );

module.exports = function load( directories ) {
    if ( typeof directories == 'string' )
        directories = [ directories ];

    directories.forEach( dir => Fs.readdir( dir, loadSub( dir ) ) );
}

function loadSub( parent ) {
    if ( !parent.endsWith( '/' ) ) parent += '/';
    return ( err, children ) => {

        if ( err )
            return Log.error( err );

        children.forEach( child => {

            // Sub folders
            if ( child.slice( -3 ) != '.js' ) {
                Log.silly( `Loading sub-folder ${parent + child}` );
                try {
                    Fs.readdir( parent + child, loadSub( parent + child + '/' ) );
                } catch ( err ) {
                    Log.error( err );
                }
            }

            // JS files
            else {
                Log.verbose( `Loading controller '${parent + child}'` );
                require( `../../../../${parent + child}` );
            }

        } );

    };
}
